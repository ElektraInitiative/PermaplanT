2
<html>
  <head>
    <title>Heatmap</title>

    <script language="javascript">
      // ----
      // toggle_div()
      //
      //  JS function to toggle one of the functions to show/block.
      // ----
      function toggle_div(hs_id, div_id) {
        var h_elem = document.getElementById(hs_id);
        var d_elem = document.getElementById(div_id);
        if (d_elem.style.display == "block") {
          d_elem.style.display = "none";
          h_elem.innerHTML = "show";
        } else {
          d_elem.style.display = "block";
          h_elem.innerHTML = "hide";
        }
      }

      // ----
      // set_stat_bars()
      // ----
      function set_stat_bars() {
        // Loop over all tables that are of linestats class.
        var tbls = document.getElementsByClassName("linestats");
        for (var i = 0; i < tbls.length; i++) {
          tbl = tbls[i];
          rws = tbl.rows;

          // Get the function level totals of the counters from the
          // second row (the pseudo line-0 row).
          vals = rws[1].getElementsByTagName("td");
          var exec_max = parseFloat(vals[1].innerHTML);
          var total_max = parseFloat(vals[2].innerHTML);
          var longest_max = parseFloat(vals[3].innerHTML);

          // Guard against division by zero errors.
          if (exec_max == 0) exec_max = 1;
          if (total_max == 0) total_max = 1;
          if (longest_max == 0) longest_max = 1;

          // Now we can calculate and set the bars relative to those
          // function level totals.
          for (var j = 1; j < rws.length; j++) {
            var vals = rws[j].getElementsByTagName("td");

            var val = parseFloat(vals[1].innerHTML);
            // var pct = val / exec_max * 100;
            // vals[1].style.backgroundSize = pct + "% 100%";
            // vals[1].style.backgroundSize = "0% 100%";
            vals[1].innerHTML = "<code>" + val.toLocaleString() + "</code>";

            val = parseFloat(vals[2].innerHTML);
            pct = (val / total_max) * 100;
            pct_str = "(" + pct.toFixed(2) + "%)";
            var need_spc = 10 - pct_str.length;
            for (var k = 0; k < need_spc; k++) {
              pct_str = "&nbsp;" + pct_str;
            }
            vals[2].style.backgroundSize = pct + "% 100%";
            vals[2].innerHTML =
              "<code>" +
              val.toLocaleString() +
              "&nbsp;&micro;s" +
              pct_str +
              "</code>";

            val = parseFloat(vals[3].innerHTML);
            // pct = val / longest_max * 100;
            // vals[3].style.backgroundSize = pct + "% 100%";
            vals[3].innerHTML =
              "<code>" + val.toLocaleString() + "&nbsp;&micro;s" + "</code>";
          }
        }
      }
    </script>

    <style>
      h1,
      h2,
      h3,
      h4 {
        color: #2222aa;
      }

      h1 {
        font-family: Helvetica, Arial;
        font-weight: 700;
        font-size: 24pt;
      }

      h2 {
        font-family: Helvetica, Arial;
        font-weight: 700;
        font-size: 18pt;
      }

      h3,
      h4 {
        font-family: Helvetica, Arial;
        font-weight: 700;
        font-size: 16pt;
      }

      p,
      li,
      dt,
      dd {
        font-family: Helvetica, Arial;
        font-size: 14pt;
      }

      pre {
        font-family: Courier, Fixed;
        font-size: 14pt;
      }

      samp {
        font-family: Courier, Fixed;
        font-weight: 900;
        font-size: 14pt;
      }

      big {
        font-weight: 900;
        font-size: 120%;
      }

      .bar {
        background-color: white;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AYEDho2r7uRnQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAFUlEQVQI12P8dlOcARtgYsABBqcEAH/aAfYx26o/AAAAAElFTkSuQmCC);
        background-repeat: no-repeat;
      }
    </style>
  </head>
  <body bgcolor="#ffffff" onload="set_stat_bars()">
    <h2>PL/pgSQL Call Graph</h2>
    <center>
      <?xml version="1.0" standalone="no"?>
      <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
      <svg
        version="1.1"
        width="1200"
        height="146"
        onload="init(evt)"
        viewBox="0 0 1200 146"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
      >
        <defs>
          <linearGradient id="background" y1="0" y2="1" x1="0" x2="0">
            <stop stop-color="#eeeeee" offset="5%" />
            <stop stop-color="#eeeeb0" offset="95%" />
          </linearGradient>
        </defs>
        <style type="text/css">
          .func_g:hover {
            stroke: black;
            stroke-width: 0.5;
            cursor: pointer;
          }
        </style>
        <script type="text/ecmascript">
          <![CDATA[ var details, svg; function init(evt) { details =
          document.getElementById("details").firstChild; svg =
          document.getElementsByTagName("svg")[0]; } function s(info) {
          details.nodeValue = "Function: " + info; } function c() {
          details.nodeValue = ' '; } function find_child(parent, name, attr) {
          var children = parent.childNodes; for (var i=0; i<children.length;i++)
          { if (children[i].tagName == name) return (attr != undefined) ?
          children[i].attributes[attr].value : children[i]; } return; } function
          orig_save(e, attr, val) { if (e.attributes["_orig_"+attr] !=
          undefined) return; if (e.attributes[attr] == undefined) return; if
          (val == undefined) val = e.attributes[attr].value;
          e.setAttribute("_orig_"+attr, val); } function orig_load(e, attr) { if
          (e.attributes["_orig_"+attr] == undefined) return;
          e.attributes[attr].value = e.attributes["_orig_"+attr].value;
          e.removeAttribute("_orig_"+attr); } function update_text(e) { var r =
          find_child(e, "rect"); var t = find_child(e, "text"); var w =
          parseFloat(r.attributes["width"].value) -3; var txt = find_child(e,
          "title").textContent.replace(/\([^(]*\)/,""); t.attributes["x"].value
          = parseFloat(r.attributes["x"].value) +3; // Smaller than this size
          won't fit anything if (w < 2*12*0.59) { t.textContent = ""; return; }
          t.textContent = txt; // Fit in full text width if (/^ *$/.test(txt) ||
          t.getSubStringLength(0, txt.length) < w) return; for (var
          x=txt.length-2; x>0; x--) { if (t.getSubStringLength(0, x+2) <= w) {
          t.textContent = txt.substring(0,x) + ".."; return; } } t.textContent =
          ""; } function zoom_reset(e) { if (e.attributes != undefined) {
          orig_load(e, "x"); orig_load(e, "width"); } if (e.childNodes ==
          undefined) return; for(var i=0, c=e.childNodes; i<c.length; i++) {
          zoom_reset(c[i]); } } function zoom_child(e, x, ratio) { if
          (e.attributes != undefined) { if (e.attributes["x"] != undefined) {
          orig_save(e, "x"); e.attributes["x"].value =
          (parseFloat(e.attributes["x"].value) - x - 10) * ratio + 10;
          if(e.tagName == "text") e.attributes["x"].value =
          find_child(e.parentNode, "rect", "x") + 3; } if (e.attributes["width"]
          != undefined) { orig_save(e, "width"); e.attributes["width"].value =
          parseFloat(e.attributes["width"].value) * ratio; } } if (e.childNodes
          == undefined) return; for(var i=0, c=e.childNodes; i<c.length; i++) {
          zoom_child(c[i], x-10, ratio); } } function zoom_parent(e) { if
          (e.attributes) { if (e.attributes["x"] != undefined) { orig_save(e,
          "x"); e.attributes["x"].value = 10; } if (e.attributes["width"] !=
          undefined) { orig_save(e, "width"); e.attributes["width"].value =
          parseInt(svg.width.baseVal.value) - (10*2); } } if (e.childNodes ==
          undefined) return; for(var i=0, c=e.childNodes; i<c.length; i++) {
          zoom_parent(c[i]); } } function zoom(node) { var attr =
          find_child(node, "rect").attributes; var width =
          parseFloat(attr["width"].value); var xmin =
          parseFloat(attr["x"].value); var xmax = parseFloat(xmin + width); var
          ymin = parseFloat(attr["y"].value); var ratio =
          (svg.width.baseVal.value - 2*10) / width; // XXX: Workaround for
          JavaScript float issues (fix me) var fudge = 0.0001; var unzoombtn =
          document.getElementById("unzoom"); unzoombtn.style["opacity"] = "1.0";
          var el = document.getElementsByTagName("g"); for(var
          i=0;i<el.length;i++){ var e = el[i]; var a = find_child(e,
          "rect").attributes; var ex = parseFloat(a["x"].value); var ew =
          parseFloat(a["width"].value); // Is it an ancestor if (0 == 0) { var
          upstack = parseFloat(a["y"].value) > ymin; } else { var upstack =
          parseFloat(a["y"].value) < ymin; } if (upstack) { // Direct ancestor
          if (ex <= xmin && (ex+ew+fudge) >= xmax) { e.style["opacity"] = "0.5";
          zoom_parent(e); e.onclick = function(e){unzoom(); zoom(this);};
          update_text(e); } // not in current path else e.style["display"] =
          "none"; } // Children maybe else { // no common path if (ex < xmin ||
          ex + fudge >= xmax) { e.style["display"] = "none"; } else {
          zoom_child(e, xmin, ratio); e.onclick = function(e){zoom(this);};
          update_text(e); } } } } function unzoom() { var unzoombtn =
          document.getElementById("unzoom"); unzoombtn.style["opacity"] = "0.0";
          var el = document.getElementsByTagName("g"); for(i=0;i<el.length;i++)
          { el[i].style["display"] = "block"; el[i].style["opacity"] = "1";
          zoom_reset(el[i]); update_text(el[i]); } } ]]>
        </script>
        <rect
          x="0.0"
          y="0"
          width="1200.0"
          height="146.0"
          fill="url(#background)"
        />
        <text
          text-anchor="middle"
          x="600.00"
          y="24"
          font-size="17"
          font-family="Verdana"
          fill="rgb(0,0,0)"
        >
          Heatmap
        </text>
        <text
          text-anchor=""
          x="10.00"
          y="129"
          font-size="12"
          font-family="Verdana"
          fill="rgb(0,0,0)"
          id="details"
        ></text>
        <text
          text-anchor=""
          x="10.00"
          y="24"
          font-size="12"
          font-family="Verdana"
          fill="rgb(0,0,0)"
          id="unzoom"
          onclick="unzoom()"
          style="opacity: 0; cursor: pointer"
        >
          Reset Zoom
        </text>
        <g
          class="func_g"
          onmouseover="s('public.calculate_score_from_shadings() oid=20458 (2,491,928 samples, 53.62%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_score_from_shadings() oid=20458 (2,491,928 samples,
            53.62%)
          </title>
          <rect
            x="556.2"
            y="49"
            width="632.7"
            height="15.0"
            fill="rgb(211,34,38)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="559.17"
            y="59.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_score_from_shadings() oid=20458
          </text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.scale_score() oid=20455 (4,229 samples, 0.09%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>public.scale_score() oid=20455 (4,229 samples, 0.09%)</title>
          <rect
            x="1188.9"
            y="65"
            width="1.1"
            height="15.0"
            fill="rgb(213,125,5)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="1191.93"
            y="75.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          ></text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.calculate_heatmap() oid=20452 (4,647,092 samples, 100.00%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_heatmap() oid=20452 (4,647,092 samples, 100.00%)
          </title>
          <rect
            x="10.0"
            y="81"
            width="1180.0"
            height="15.0"
            fill="rgb(222,223,25)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="13.00"
            y="91.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_heatmap() oid=20452
          </text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.get_plant_relations() oid=20006 (1,724,695 samples, 37.11%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.get_plant_relations() oid=20006 (1,724,695 samples, 37.11%)
          </title>
          <rect
            x="118.2"
            y="33"
            width="438.0"
            height="15.0"
            fill="rgb(220,179,37)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="121.23"
            y="43.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.get_plant_relations() oid=20006
          </text>
        </g>
        <g
          class="func_g"
          onmouseover="s('all (4,647,092 samples, 100%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>all (4,647,092 samples, 100%)</title>
          <rect
            x="10.0"
            y="97"
            width="1180.0"
            height="15.0"
            fill="rgb(218,187,44)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="13.00"
            y="107.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          ></text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.calculate_score() oid=20456 (4,568,739 samples, 98.31%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_score() oid=20456 (4,568,739 samples, 98.31%)
          </title>
          <rect
            x="28.8"
            y="65"
            width="1160.1"
            height="15.0"
            fill="rgb(247,50,25)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="31.82"
            y="75.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_score() oid=20456
          </text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.calculate_score_from_relations() oid=20457 (2,027,016 samples, 43.62%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_score_from_relations() oid=20457 (2,027,016
            samples, 43.62%)
          </title>
          <rect
            x="41.5"
            y="49"
            width="514.7"
            height="15.0"
            fill="rgb(214,78,17)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="44.47"
            y="59.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_score_from_relations() oid=20457
          </text>
        </g>
      </svg>
    </center>
    <h2>List of functions detailed below</h2>
    <ul>
      <li><a href="#A20452">public.calculate_heatmap() oid=20452</a></li>
      <li><a href="#A20456">public.calculate_score() oid=20456</a></li>
      <li>
        <a href="#A20457">public.calculate_score_from_relations() oid=20457</a>
      </li>
      <li>
        <a href="#A20458">public.calculate_score_from_shadings() oid=20458</a>
      </li>
      <li><a href="#A20006">public.get_plant_relations() oid=20006</a></li>
      <li><a href="#A20455">public.scale_score() oid=20455</a></li>
    </ul>
    <h2>All 6 functions (by self_time)</h2>
    <a name="A20458" />
    <h3>
      Function public.calculate_score_from_shadings() oid=20458 (<a
        id="toggle_20458"
        href="javascript:toggle_div('toggle_20458', 'div_20458')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 2,491,928 &micro;s<br />
      total_time = 2,491,928 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_score_from_shadings&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_layer_id integer,<br />&nbsp;p_plant_id integer,<br />&nbsp;date
              date,<br />&nbsp;x_pos integer,<br />&nbsp;y_pos integer)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20458" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">2491928</td>
            <td align="right">1208</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;GEOMETRY;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plant_shade&nbsp;SHADE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;plant_light_requirement&nbsp;light_requirement&nbsp;[];</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;SHADE&nbsp;[]&nbsp;:=&nbsp;&#x27;{}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;shading_shade&nbsp;SHADE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;all_values&nbsp;SHADE[];</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;pos1&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;pos2&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">2485951</td>
            <td align="right">1207</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">61145</td>
            <td align="right">60</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;layers&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_layer_id&nbsp;AND&nbsp;type&nbsp;=&nbsp;&#x27;shade&#x27;)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Shade&nbsp;layer&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&#x27;,&nbsp;p_layer_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Get&nbsp;the&nbsp;required&nbsp;light&nbsp;level&nbsp;and&nbsp;preferred&nbsp;shade&nbsp;level&nbsp;of&nbsp;the&nbsp;plant</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">41957</td>
            <td align="right">124</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;light_requirement,&nbsp;shade&nbsp;INTO&nbsp;plant_light_requirement,&nbsp;plant_shade</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;plants</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_plant_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Create&nbsp;a&nbsp;point&nbsp;from&nbsp;x_pos&nbsp;and&nbsp;y_pos</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">1499</td>
            <td align="right">25</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;:=&nbsp;ST_SetSRID(ST_MakePoint(x_pos,&nbsp;y_pos),&nbsp;4326);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Select&nbsp;the&nbsp;shading&nbsp;with&nbsp;the&nbsp;darkest&nbsp;shade&nbsp;that&nbsp;intersects&nbsp;the&nbsp;point</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>25</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">2223975</td>
            <td align="right">996</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;shade&nbsp;INTO&nbsp;shading_shade</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>26</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;shadings</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>27</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;layer_id&nbsp;=&nbsp;p_layer_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>28</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(add_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;add_date&nbsp;&lt;=&nbsp;date)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>29</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(remove_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;remove_date&nbsp;&gt;&nbsp;date)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>30</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ST_Intersects(geometry,&nbsp;point)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>31</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;shade&nbsp;DESC</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>32</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;LIMIT&nbsp;1;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>33</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>34</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;there&#x27;s&nbsp;no&nbsp;shading,&nbsp;then&nbsp;there&nbsp;is&nbsp;sun.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>35</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">1280</td>
            <td align="right">20</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;FOUND&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>36</code></td>
            <td align="right">7792</td>
            <td class="bar" align="right">141</td>
            <td align="right">18</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shading_shade&nbsp;:=&nbsp;&#x27;no&nbsp;shade&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>37</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>38</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>39</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Check&nbsp;if&nbsp;the&nbsp;plant&nbsp;can&nbsp;survive&nbsp;at&nbsp;the&nbsp;position.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>40</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;the&nbsp;plant&nbsp;can&#x27;t&nbsp;survive&nbsp;set&nbsp;preference=-100&nbsp;and&nbsp;relevance=100.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>41</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">13444</td>
            <td align="right">220</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;plant_light_requirement&nbsp;IS&nbsp;NOT&nbsp;NULL</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>42</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>&nbsp;&nbsp;&nbsp;&nbsp;THEN</code></td>
          </tr>
          <tr>
            <td align="right"><code>43</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">1665</td>
            <td align="right">143</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&#x27;full&nbsp;sun&#x27;&nbsp;=&nbsp;ANY(plant_light_requirement)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>44</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>45</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">116</td>
            <td align="right">49</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;:=&nbsp;allowed_shades&nbsp;||&nbsp;&#x27;{&quot;no&nbsp;shade&quot;,&nbsp;&quot;light&nbsp;shade&quot;}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>46</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>47</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">70</td>
            <td align="right">24</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&#x27;partial&nbsp;sun/shade&#x27;&nbsp;=&nbsp;ANY(plant_light_requirement)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>48</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>49</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">17</td>
            <td align="right">12</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;:=&nbsp;allowed_shades&nbsp;||&nbsp;&#x27;{&quot;light&nbsp;shade&quot;,&nbsp;&quot;partial&nbsp;shade&quot;,&nbsp;&quot;permanent&nbsp;shade&quot;}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>50</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>51</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">74</td>
            <td align="right">63</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&#x27;full&nbsp;shade&#x27;&nbsp;=&nbsp;ANY(plant_light_requirement)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>52</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>53</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;:=&nbsp;allowed_shades&nbsp;||&nbsp;&#x27;{&quot;permanent&nbsp;shade&quot;,&nbsp;&quot;permanent&nbsp;deep&nbsp;shade&quot;}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>54</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>55</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>56</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">319</td>
            <td align="right">34</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;(shading_shade&nbsp;=&nbsp;ANY(allowed_shades))</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>57</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>58</code></td>
            <td align="right">744</td>
            <td class="bar" align="right">50</td>
            <td align="right">17</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;-100;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>59</code></td>
            <td align="right">744</td>
            <td class="bar" align="right">5</td>
            <td align="right">5</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;100;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>60</code></td>
            <td align="right">744</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>61</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>62</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>63</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>64</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;there&#x27;s&nbsp;no&nbsp;shading,&nbsp;return&nbsp;0.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>65</code></td>
            <td align="right">9256</td>
            <td class="bar" align="right">7</td>
            <td align="right">6</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;plant_shade&nbsp;IS&nbsp;NULL&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>66</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>67</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>68</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>69</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>70</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>71</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Get&nbsp;all&nbsp;possible&nbsp;enum&nbsp;values</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>72</code></td>
            <td align="right">9256</td>
            <td class="bar" align="right">48905</td>
            <td align="right">66</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;enum_range(NULL::SHADE)&nbsp;INTO&nbsp;all_values;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>73</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>74</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Get&nbsp;the&nbsp;position&nbsp;of&nbsp;each&nbsp;enum&nbsp;value&nbsp;in&nbsp;the&nbsp;array</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>75</code></td>
            <td align="right">9256</td>
            <td class="bar" align="right">12554</td>
            <td align="right">35</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;array_position(all_values,&nbsp;plant_shade)&nbsp;INTO&nbsp;pos1;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>76</code></td>
            <td align="right">9256</td>
            <td class="bar" align="right">9505</td>
            <td align="right">48</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;array_position(all_values,&nbsp;shading_shade)&nbsp;INTO&nbsp;pos2;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>77</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>78</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;the&nbsp;&#x27;distance&#x27;&nbsp;to&nbsp;the&nbsp;preferred&nbsp;shade&nbsp;as&nbsp;a&nbsp;values&nbsp;between&nbsp;-1&nbsp;and&nbsp;1</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>79</code></td>
            <td align="right">9256</td>
            <td class="bar" align="right">2350</td>
            <td align="right">129</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;(0.5&nbsp;-&nbsp;(abs(pos1&nbsp;-&nbsp;pos2)&nbsp;/&nbsp;(ARRAY_LENGTH(all_values,&nbsp;1)&nbsp;-&nbsp;1)::REAL)^0.5)&nbsp;*&nbsp;2.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>80</code></td>
            <td align="right">9256</td>
            <td class="bar" align="right">661</td>
            <td align="right">26</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;1.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>81</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>82</code></td>
            <td align="right">9256</td>
            <td class="bar" align="right">12</td>
            <td align="right">12</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>83</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>84</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20006" />
    <h3>
      Function public.get_plant_relations() oid=20006 (<a
        id="toggle_20006"
        href="javascript:toggle_div('toggle_20006', 'div_20006')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 1,724,695 &micro;s<br />
      total_time = 1,724,695 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.get_plant_relations&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_layer_id integer,<br />&nbsp;p_plant_id integer,<br />&nbsp;date
              date)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b
            ><code
              >&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;TABLE(x&nbsp;integer,&nbsp;y&nbsp;integer,&nbsp;relation&nbsp;relation_type)</code
            ></b
          >
        </td>
      </tr>
    </table>
    <div id="div_20006" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">1724695</td>
            <td align="right">933</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">1720520</td>
            <td align="right">933</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">1718074</td>
            <td align="right">932</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;QUERY</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;We&nbsp;only&nbsp;need&nbsp;x,y&nbsp;and&nbsp;type&nbsp;of&nbsp;relation&nbsp;to&nbsp;calculate&nbsp;a&nbsp;score.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;plantings.x,&nbsp;plantings.y,&nbsp;relations.relation</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;plantings</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;plants&nbsp;ON&nbsp;plantings.plant_id&nbsp;=&nbsp;plants.id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;(</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;We&nbsp;need&nbsp;UNION&nbsp;as&nbsp;the&nbsp;relation&nbsp;is&nbsp;bidirectional.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;plant1&nbsp;AS&nbsp;plant,&nbsp;r1.relation</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;relations&nbsp;r1</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;plant2&nbsp;=&nbsp;p_plant_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;r1.relation&nbsp;!=&nbsp;&#x27;neutral&#x27;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNION</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;plant2&nbsp;AS&nbsp;plant,&nbsp;r2.relation</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;relations&nbsp;r2</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;plant1&nbsp;=&nbsp;p_plant_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;r2.relation&nbsp;!=&nbsp;&#x27;neutral&#x27;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;relations&nbsp;ON&nbsp;plants.id&nbsp;=&nbsp;relations.plant</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;plantings.layer_id&nbsp;=&nbsp;p_layer_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(plantings.add_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;plantings.add_date&nbsp;&lt;=&nbsp;date)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(plantings.remove_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;plantings.remove_date&nbsp;&gt;&nbsp;date);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20457" />
    <h3>
      Function public.calculate_score_from_relations() oid=20457 (<a
        id="toggle_20457"
        href="javascript:toggle_div('toggle_20457', 'div_20457')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 302,321 &micro;s<br />
      total_time = 2,027,016 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_score_from_relations&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_layer_id integer,<br />&nbsp;p_plant_id integer,<br />&nbsp;date
              date,<br />&nbsp;x_pos integer,<br />&nbsp;y_pos integer)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20457" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">2027016</td>
            <td align="right">1621</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plant_relation&nbsp;RECORD;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;distance&nbsp;REAL;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;weight&nbsp;REAL;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">2023602</td>
            <td align="right">1620</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">50350</td>
            <td align="right">251</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;layers&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_layer_id&nbsp;AND&nbsp;type&nbsp;=&nbsp;&#x27;plants&#x27;)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Plant&nbsp;layer&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&#x27;,&nbsp;p_layer_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">303</td>
            <td align="right">31</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">19</td>
            <td align="right">12</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">1956068</td>
            <td align="right">1340</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;plant_relation&nbsp;IN&nbsp;(SELECT&nbsp;*&nbsp;FROM&nbsp;get_plant_relations(p_layer_id,&nbsp;p_plant_id,&nbsp;date))&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;calculate&nbsp;euclidean&nbsp;distance</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">4103</td>
            <td align="right">70</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distance&nbsp;:=&nbsp;sqrt((plant_relation.x&nbsp;-&nbsp;x_pos)^2&nbsp;+&nbsp;(plant_relation.y&nbsp;-&nbsp;y_pos)^2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;calculate&nbsp;weight&nbsp;based&nbsp;on&nbsp;distance</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;weight&nbsp;decreases&nbsp;between&nbsp;1&nbsp;and&nbsp;0&nbsp;based&nbsp;on&nbsp;distance</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;distance&nbsp;is&nbsp;squared&nbsp;so&nbsp;it&nbsp;decreases&nbsp;faster&nbsp;the&nbsp;further&nbsp;away</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;weight&nbsp;is&nbsp;halved&nbsp;at&nbsp;50&nbsp;cm&nbsp;away</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">479</td>
            <td align="right">127</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weight&nbsp;:=&nbsp;1&nbsp;/&nbsp;(1&nbsp;+&nbsp;(distance&nbsp;/&nbsp;50)^2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>25</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;score&nbsp;based&nbsp;on&nbsp;relation</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>26</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">535</td>
            <td align="right">100</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;plant_relation.relation&nbsp;=&nbsp;&#x27;companion&#x27;&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>27</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">338</td>
            <td align="right">66</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;score.preference&nbsp;+&nbsp;0.5&nbsp;*&nbsp;weight;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>28</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>29</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;score.preference&nbsp;-&nbsp;0.5&nbsp;*&nbsp;weight;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>30</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>31</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>32</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">347</td>
            <td align="right">47</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;score.relevance&nbsp;+&nbsp;0.5&nbsp;*&nbsp;weight;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>33</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>34</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>35</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>36</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>37</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20452" />
    <h3>
      Function public.calculate_heatmap() oid=20452 (<a
        id="toggle_20452"
        href="javascript:toggle_div('toggle_20452', 'div_20452')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 74,124 &micro;s<br />
      total_time = 4,647,092 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_heatmap&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_map_id integer,<br />&nbsp;p_layer_ids integer[],<br />&nbsp;p_plant_id
              integer,<br />&nbsp;date date,<br />&nbsp;granularity integer,<br />&nbsp;x_min
              integer,<br />&nbsp;y_min integer,<br />&nbsp;x_max integer,<br />&nbsp;y_max
              integer)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b
            ><code
              >&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;TABLE(preference&nbsp;real,&nbsp;relevance&nbsp;real,&nbsp;x&nbsp;integer,&nbsp;y&nbsp;integer)</code
            ></b
          >
        </td>
      </tr>
    </table>
    <div id="div_20452" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">4647092</td>
            <td align="right">4647092</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;map_geometry&nbsp;GEOMETRY(POLYGON,&nbsp;4326);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;GEOMETRY;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;bbox&nbsp;GEOMETRY;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;num_cols&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;num_rows&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;x_pos&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;y_pos&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plant_relation&nbsp;RECORD;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">4647091</td>
            <td align="right">4647091</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Makes&nbsp;sure&nbsp;the&nbsp;layers&nbsp;exists&nbsp;and&nbsp;fits&nbsp;to&nbsp;the&nbsp;map</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">408</td>
            <td align="right">408</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;i&nbsp;IN&nbsp;1..array_length(p_layer_ids,&nbsp;1)&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">2</td>
            <td class="bar" align="right">358</td>
            <td align="right">334</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;layers&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_layer_ids[i]&nbsp;AND&nbsp;map_id&nbsp;=&nbsp;p_map_id)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Layer&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&nbsp;on&nbsp;map&nbsp;with&nbsp;id&nbsp;%&#x27;,&nbsp;p_layer_ids[i],&nbsp;p_map_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Makes&nbsp;sure&nbsp;the&nbsp;plant&nbsp;exists</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">212</td>
            <td align="right">212</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;plants&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_plant_id)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Plant&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&#x27;,&nbsp;p_plant_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;INTO&nbsp;STRICT&nbsp;makes&nbsp;sure&nbsp;the&nbsp;map&nbsp;exists.&nbsp;Does&nbsp;have&nbsp;to&nbsp;be&nbsp;explicitly&nbsp;checked&nbsp;as&nbsp;bounding&nbsp;box&nbsp;calculation&nbsp;would&nbsp;error&nbsp;anyways.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>25</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">139</td>
            <td align="right">139</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;geometry&nbsp;FROM&nbsp;maps&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_map_id&nbsp;INTO&nbsp;STRICT&nbsp;map_geometry;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>26</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>27</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;and&nbsp;columns&nbsp;based&nbsp;on&nbsp;the&nbsp;map&#x27;s&nbsp;size&nbsp;and&nbsp;granularity</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>28</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">77</td>
            <td align="right">77</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;num_cols&nbsp;:=&nbsp;FLOOR((x_max&nbsp;-&nbsp;x_min)&nbsp;/&nbsp;granularity);&nbsp;--&nbsp;Adjusted&nbsp;for&nbsp;granularity</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>29</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">12</td>
            <td align="right">12</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;num_rows&nbsp;:=&nbsp;FLOOR((y_max&nbsp;-&nbsp;y_min)&nbsp;/&nbsp;granularity);&nbsp;--&nbsp;Adjusted&nbsp;for&nbsp;granularity</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>30</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>31</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;the&nbsp;score&nbsp;for&nbsp;each&nbsp;point&nbsp;on&nbsp;the&nbsp;heatmap</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>32</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">4646239</td>
            <td align="right">4646239</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;i&nbsp;IN&nbsp;0..num_cols-1&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>33</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;i&nbsp;and&nbsp;j&nbsp;do&nbsp;not&nbsp;represent&nbsp;coordinates.&nbsp;We&nbsp;need&nbsp;to&nbsp;adjust&nbsp;them&nbsp;to&nbsp;actual&nbsp;coordinates.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>34</code></td>
            <td align="right">100</td>
            <td class="bar" align="right">30</td>
            <td align="right">30</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x_pos&nbsp;:=&nbsp;x_min&nbsp;+&nbsp;(i&nbsp;*&nbsp;granularity)&nbsp;+&nbsp;(granularity&nbsp;/&nbsp;2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>35</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>36</code></td>
            <td align="right">100</td>
            <td class="bar" align="right">4646099</td>
            <td align="right">51982</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;j&nbsp;IN&nbsp;0..num_rows-1&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>37</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">36</td>
            <td align="right">13</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_pos&nbsp;:=&nbsp;y_min&nbsp;+&nbsp;(j&nbsp;*&nbsp;granularity)&nbsp;+&nbsp;(granularity&nbsp;/&nbsp;2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>38</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>39</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Create&nbsp;a&nbsp;point&nbsp;from&nbsp;x_pos&nbsp;and&nbsp;y_pos</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>40</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">314</td>
            <td align="right">53</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;:=&nbsp;ST_SetSRID(ST_MakePoint(x_pos,&nbsp;y_pos),&nbsp;4326);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>41</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>42</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;the&nbsp;point&nbsp;is&nbsp;on&nbsp;the&nbsp;map&nbsp;calculate&nbsp;a&nbsp;score;&nbsp;otherwise&nbsp;set&nbsp;score&nbsp;to&nbsp;0.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>43</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">4625471</td>
            <td align="right">3246</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ST_Intersects(point,&nbsp;map_geometry)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>44</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">4582677</td>
            <td align="right">3043</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;:=&nbsp;calculate_score(p_map_id,&nbsp;p_layer_ids,&nbsp;p_plant_id,&nbsp;date,&nbsp;x_pos,&nbsp;y_pos);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>45</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">22332</td>
            <td align="right">122</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;:=&nbsp;scale_score(score);&nbsp;&nbsp;--&nbsp;scale&nbsp;to&nbsp;be&nbsp;between&nbsp;0&nbsp;and&nbsp;1</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>46</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">6</td>
            <td align="right">6</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preference&nbsp;:=&nbsp;score.preference;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>47</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">5</td>
            <td align="right">5</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relevance&nbsp;:=&nbsp;score.relevance;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>48</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>49</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preference&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>50</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relevance&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>51</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>52</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>53</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">5</td>
            <td align="right">5</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;i;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>54</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">4</td>
            <td align="right">4</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;j;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>55</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>56</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">192</td>
            <td align="right">36</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;NEXT;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>57</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>58</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>59</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>60</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20456" />
    <h3>
      Function public.calculate_score() oid=20456 (<a
        id="toggle_20456"
        href="javascript:toggle_div('toggle_20456', 'div_20456')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 49,795 &micro;s<br />
      total_time = 4,568,739 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_score&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_map_id integer,<br />&nbsp;p_layer_ids integer[],<br />&nbsp;p_plant_id
              integer,<br />&nbsp;date date,<br />&nbsp;x_pos integer,<br />&nbsp;y_pos
              integer)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20456" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">4568739</td>
            <td align="right">2993</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plants&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;shades&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">4566985</td>
            <td align="right">2992</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">2042109</td>
            <td align="right">1697</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;plants&nbsp;:=&nbsp;calculate_score_from_relations(p_layer_ids[1],&nbsp;p_plant_id,&nbsp;date,&nbsp;x_pos,&nbsp;y_pos);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">2513119</td>
            <td align="right">1261</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;shades&nbsp;:=&nbsp;calculate_score_from_shadings(p_layer_ids[2],&nbsp;p_plant_id,&nbsp;date,&nbsp;x_pos,&nbsp;y_pos);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">69</td>
            <td align="right">25</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;plants.preference&nbsp;+&nbsp;shades.preference;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">9</td>
            <td align="right">8</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;plants.relevance&nbsp;+&nbsp;shades.relevance;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20455" />
    <h3>
      Function public.scale_score() oid=20455 (<a
        id="toggle_20455"
        href="javascript:toggle_div('toggle_20455', 'div_20455')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 4,229 &micro;s<br />
      total_time = 4,229 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.scale_score&nbsp;</code></b>
        </td>
        <td>
          <b><code>(input score)</code></b>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20455" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">4229</td>
            <td align="right">88</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">978</td>
            <td align="right">88</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">123</td>
            <td align="right">43</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;1&nbsp;/&nbsp;(1&nbsp;+&nbsp;exp(-input.preference));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;standard&nbsp;sigmoid,&nbsp;so&nbsp;that&nbsp;f(0)=0.5</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">56</td>
            <td align="right">44</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;(2&nbsp;/&nbsp;(1&nbsp;+&nbsp;exp(-input.relevance)))&nbsp;-&nbsp;1;&nbsp;&nbsp;&nbsp;--&nbsp;modified&nbsp;sigmoid,&nbsp;so&nbsp;that&nbsp;f(0)=0</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">34</td>
            <td align="right">12</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
  </body>
</html>
