<html>
  <head>
    <title>Heatmap</title>

    <script language="javascript">
      // ----
      // toggle_div()
      //
      //  JS function to toggle one of the functions to show/block.
      // ----
      function toggle_div(hs_id, div_id) {
        var h_elem = document.getElementById(hs_id);
        var d_elem = document.getElementById(div_id);
        if (d_elem.style.display == "block") {
          d_elem.style.display = "none";
          h_elem.innerHTML = "show";
        } else {
          d_elem.style.display = "block";
          h_elem.innerHTML = "hide";
        }
      }

      // ----
      // set_stat_bars()
      // ----
      function set_stat_bars() {
        // Loop over all tables that are of linestats class.
        var tbls = document.getElementsByClassName("linestats");
        for (var i = 0; i < tbls.length; i++) {
          tbl = tbls[i];
          rws = tbl.rows;

          // Get the function level totals of the counters from the
          // second row (the pseudo line-0 row).
          vals = rws[1].getElementsByTagName("td");
          var exec_max = parseFloat(vals[1].innerHTML);
          var total_max = parseFloat(vals[2].innerHTML);
          var longest_max = parseFloat(vals[3].innerHTML);

          // Guard against division by zero errors.
          if (exec_max == 0) exec_max = 1;
          if (total_max == 0) total_max = 1;
          if (longest_max == 0) longest_max = 1;

          // Now we can calculate and set the bars relative to those
          // function level totals.
          for (var j = 1; j < rws.length; j++) {
            var vals = rws[j].getElementsByTagName("td");

            var val = parseFloat(vals[1].innerHTML);
            // var pct = val / exec_max * 100;
            // vals[1].style.backgroundSize = pct + "% 100%";
            // vals[1].style.backgroundSize = "0% 100%";
            vals[1].innerHTML = "<code>" + val.toLocaleString() + "</code>";

            val = parseFloat(vals[2].innerHTML);
            pct = (val / total_max) * 100;
            pct_str = "(" + pct.toFixed(2) + "%)";
            var need_spc = 10 - pct_str.length;
            for (var k = 0; k < need_spc; k++) {
              pct_str = "&nbsp;" + pct_str;
            }
            vals[2].style.backgroundSize = pct + "% 100%";
            vals[2].innerHTML =
              "<code>" +
              val.toLocaleString() +
              "&nbsp;&micro;s" +
              pct_str +
              "</code>";

            val = parseFloat(vals[3].innerHTML);
            // pct = val / longest_max * 100;
            // vals[3].style.backgroundSize = pct + "% 100%";
            vals[3].innerHTML =
              "<code>" + val.toLocaleString() + "&nbsp;&micro;s" + "</code>";
          }
        }
      }
    </script>

    <style>
      h1,
      h2,
      h3,
      h4 {
        color: #2222aa;
      }

      h1 {
        font-family: Helvetica, Arial;
        font-weight: 700;
        font-size: 24pt;
      }

      h2 {
        font-family: Helvetica, Arial;
        font-weight: 700;
        font-size: 18pt;
      }

      h3,
      h4 {
        font-family: Helvetica, Arial;
        font-weight: 700;
        font-size: 16pt;
      }

      p,
      li,
      dt,
      dd {
        font-family: Helvetica, Arial;
        font-size: 14pt;
      }

      pre {
        font-family: Courier, Fixed;
        font-size: 14pt;
      }

      samp {
        font-family: Courier, Fixed;
        font-weight: 900;
        font-size: 14pt;
      }

      big {
        font-weight: 900;
        font-size: 120%;
      }

      .bar {
        background-color: white;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AYEDho2r7uRnQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAFUlEQVQI12P8dlOcARtgYsABBqcEAH/aAfYx26o/AAAAAElFTkSuQmCC);
        background-repeat: no-repeat;
      }
    </style>
  </head>
  <body bgcolor="#ffffff" onload="set_stat_bars()">
    <h2>PL/pgSQL Call Graph</h2>
    <center>
      <?xml version="1.0" standalone="no"?>
      <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
      <svg
        version="1.1"
        width="1200"
        height="130"
        onload="init(evt)"
        viewBox="0 0 1200 130"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
      >
        <defs>
          <linearGradient id="background" y1="0" y2="1" x1="0" x2="0">
            <stop stop-color="#eeeeee" offset="5%" />
            <stop stop-color="#eeeeb0" offset="95%" />
          </linearGradient>
        </defs>
        <style type="text/css">
          .func_g:hover {
            stroke: black;
            stroke-width: 0.5;
            cursor: pointer;
          }
        </style>
        <script type="text/ecmascript">
          <![CDATA[ var details, svg; function init(evt) { details =
          document.getElementById("details").firstChild; svg =
          document.getElementsByTagName("svg")[0]; } function s(info) {
          details.nodeValue = "Function: " + info; } function c() {
          details.nodeValue = ' '; } function find_child(parent, name, attr) {
          var children = parent.childNodes; for (var i=0; i<children.length;i++)
          { if (children[i].tagName == name) return (attr != undefined) ?
          children[i].attributes[attr].value : children[i]; } return; } function
          orig_save(e, attr, val) { if (e.attributes["_orig_"+attr] !=
          undefined) return; if (e.attributes[attr] == undefined) return; if
          (val == undefined) val = e.attributes[attr].value;
          e.setAttribute("_orig_"+attr, val); } function orig_load(e, attr) { if
          (e.attributes["_orig_"+attr] == undefined) return;
          e.attributes[attr].value = e.attributes["_orig_"+attr].value;
          e.removeAttribute("_orig_"+attr); } function update_text(e) { var r =
          find_child(e, "rect"); var t = find_child(e, "text"); var w =
          parseFloat(r.attributes["width"].value) -3; var txt = find_child(e,
          "title").textContent.replace(/\([^(]*\)/,""); t.attributes["x"].value
          = parseFloat(r.attributes["x"].value) +3; // Smaller than this size
          won't fit anything if (w < 2*12*0.59) { t.textContent = ""; return; }
          t.textContent = txt; // Fit in full text width if (/^ *$/.test(txt) ||
          t.getSubStringLength(0, txt.length) < w) return; for (var
          x=txt.length-2; x>0; x--) { if (t.getSubStringLength(0, x+2) <= w) {
          t.textContent = txt.substring(0,x) + ".."; return; } } t.textContent =
          ""; } function zoom_reset(e) { if (e.attributes != undefined) {
          orig_load(e, "x"); orig_load(e, "width"); } if (e.childNodes ==
          undefined) return; for(var i=0, c=e.childNodes; i<c.length; i++) {
          zoom_reset(c[i]); } } function zoom_child(e, x, ratio) { if
          (e.attributes != undefined) { if (e.attributes["x"] != undefined) {
          orig_save(e, "x"); e.attributes["x"].value =
          (parseFloat(e.attributes["x"].value) - x - 10) * ratio + 10;
          if(e.tagName == "text") e.attributes["x"].value =
          find_child(e.parentNode, "rect", "x") + 3; } if (e.attributes["width"]
          != undefined) { orig_save(e, "width"); e.attributes["width"].value =
          parseFloat(e.attributes["width"].value) * ratio; } } if (e.childNodes
          == undefined) return; for(var i=0, c=e.childNodes; i<c.length; i++) {
          zoom_child(c[i], x-10, ratio); } } function zoom_parent(e) { if
          (e.attributes) { if (e.attributes["x"] != undefined) { orig_save(e,
          "x"); e.attributes["x"].value = 10; } if (e.attributes["width"] !=
          undefined) { orig_save(e, "width"); e.attributes["width"].value =
          parseInt(svg.width.baseVal.value) - (10*2); } } if (e.childNodes ==
          undefined) return; for(var i=0, c=e.childNodes; i<c.length; i++) {
          zoom_parent(c[i]); } } function zoom(node) { var attr =
          find_child(node, "rect").attributes; var width =
          parseFloat(attr["width"].value); var xmin =
          parseFloat(attr["x"].value); var xmax = parseFloat(xmin + width); var
          ymin = parseFloat(attr["y"].value); var ratio =
          (svg.width.baseVal.value - 2*10) / width; // XXX: Workaround for
          JavaScript float issues (fix me) var fudge = 0.0001; var unzoombtn =
          document.getElementById("unzoom"); unzoombtn.style["opacity"] = "1.0";
          var el = document.getElementsByTagName("g"); for(var
          i=0;i<el.length;i++){ var e = el[i]; var a = find_child(e,
          "rect").attributes; var ex = parseFloat(a["x"].value); var ew =
          parseFloat(a["width"].value); // Is it an ancestor if (0 == 0) { var
          upstack = parseFloat(a["y"].value) > ymin; } else { var upstack =
          parseFloat(a["y"].value) < ymin; } if (upstack) { // Direct ancestor
          if (ex <= xmin && (ex+ew+fudge) >= xmax) { e.style["opacity"] = "0.5";
          zoom_parent(e); e.onclick = function(e){unzoom(); zoom(this);};
          update_text(e); } // not in current path else e.style["display"] =
          "none"; } // Children maybe else { // no common path if (ex < xmin ||
          ex + fudge >= xmax) { e.style["display"] = "none"; } else {
          zoom_child(e, xmin, ratio); e.onclick = function(e){zoom(this);};
          update_text(e); } } } } function unzoom() { var unzoombtn =
          document.getElementById("unzoom"); unzoombtn.style["opacity"] = "0.0";
          var el = document.getElementsByTagName("g"); for(i=0;i<el.length;i++)
          { el[i].style["display"] = "block"; el[i].style["opacity"] = "1";
          zoom_reset(el[i]); update_text(el[i]); } } ]]>
        </script>
        <rect
          x="0.0"
          y="0"
          width="1200.0"
          height="130.0"
          fill="url(#background)"
        />
        <text
          text-anchor="middle"
          x="600.00"
          y="24"
          font-size="17"
          font-family="Verdana"
          fill="rgb(0,0,0)"
        >
          Heatmap
        </text>
        <text
          text-anchor=""
          x="10.00"
          y="113"
          font-size="12"
          font-family="Verdana"
          fill="rgb(0,0,0)"
          id="details"
        ></text>
        <text
          text-anchor=""
          x="10.00"
          y="24"
          font-size="12"
          font-family="Verdana"
          fill="rgb(0,0,0)"
          id="unzoom"
          onclick="unzoom()"
          style="opacity: 0; cursor: pointer"
        >
          Reset Zoom
        </text>
        <g
          class="func_g"
          onmouseover="s('public.calculate_score() oid=20436 (511,079 samples, 88.35%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_score() oid=20436 (511,079 samples, 88.35%)
          </title>
          <rect
            x="144.1"
            y="49"
            width="1042.6"
            height="15.0"
            fill="rgb(251,147,46)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="147.12"
            y="59.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_score() oid=20436
          </text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.scale_score() oid=20429 (457 samples, 0.08%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>public.scale_score() oid=20429 (457 samples, 0.08%)</title>
          <rect
            x="1189.1"
            y="49"
            width="0.9"
            height="15.0"
            fill="rgb(211,159,36)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="1192.07"
            y="59.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          ></text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.calculate_score_from_shadings() oid=20432 (272,389 samples, 47.09%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_score_from_shadings() oid=20432 (272,389 samples,
            47.09%)
          </title>
          <rect
            x="631.0"
            y="33"
            width="555.7"
            height="15.0"
            fill="rgb(250,12,7)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="634.02"
            y="43.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_score_from_shadings() oid=20432
          </text>
        </g>
        <g
          class="func_g"
          onmouseover="s('all (578,463 samples, 100%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>all (578,463 samples, 100%)</title>
          <rect
            x="10.0"
            y="81"
            width="1180.0"
            height="15.0"
            fill="rgb(237,6,2)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="13.00"
            y="91.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          ></text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.calculate_score_from_relations() oid=20437 (196,206 samples, 33.92%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_score_from_relations() oid=20437 (196,206 samples,
            33.92%)
          </title>
          <rect
            x="230.8"
            y="33"
            width="400.2"
            height="15.0"
            fill="rgb(227,10,10)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="233.79"
            y="43.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_score_from_relations() oid=20437
          </text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.get_plant_relations_array() oid=20438 (1,177 samples, 0.20%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.get_plant_relations_array() oid=20438 (1,177 samples, 0.20%)
          </title>
          <rect
            x="1186.7"
            y="49"
            width="2.4"
            height="15.0"
            fill="rgb(220,68,46)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="1189.67"
            y="59.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          ></text>
        </g>
        <g
          class="func_g"
          onmouseover="s('public.calculate_heatmap() oid=20426 (578,463 samples, 100.00%)')"
          onmouseout="c()"
          onclick="zoom(this)"
        >
          <title>
            public.calculate_heatmap() oid=20426 (578,463 samples, 100.00%)
          </title>
          <rect
            x="10.0"
            y="65"
            width="1180.0"
            height="15.0"
            fill="rgb(237,54,6)"
            rx="2"
            ry="2"
          />
          <text
            text-anchor=""
            x="13.00"
            y="75.5"
            font-size="12"
            font-family="Verdana"
            fill="rgb(0,0,0)"
          >
            public.calculate_heatmap() oid=20426
          </text>
        </g>
      </svg>
    </center>
    <h2>List of functions detailed below</h2>
    <ul>
      <li><a href="#A20426">public.calculate_heatmap() oid=20426</a></li>
      <li><a href="#A20436">public.calculate_score() oid=20436</a></li>
      <li>
        <a href="#A20437">public.calculate_score_from_relations() oid=20437</a>
      </li>
      <li>
        <a href="#A20432">public.calculate_score_from_shadings() oid=20432</a>
      </li>
      <li>
        <a href="#A20438">public.get_plant_relations_array() oid=20438</a>
      </li>
      <li><a href="#A20429">public.scale_score() oid=20429</a></li>
    </ul>
    <h2>All 6 functions (by self_time)</h2>
    <a name="A20432" />
    <h3>
      Function public.calculate_score_from_shadings() oid=20432 (<a
        id="toggle_20432"
        href="javascript:toggle_div('toggle_20432', 'div_20432')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 272,389 &micro;s<br />
      total_time = 272,389 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_score_from_shadings&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_layer_id integer,<br />&nbsp;p_plant_id integer,<br />&nbsp;date
              date,<br />&nbsp;x_pos integer,<br />&nbsp;y_pos integer)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20432" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">272389</td>
            <td align="right">839</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;GEOMETRY;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plant_shade&nbsp;SHADE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;plant_light_requirement&nbsp;light_requirement&nbsp;[];</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;SHADE&nbsp;[]&nbsp;:=&nbsp;&#x27;{}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;shading_shade&nbsp;SHADE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;all_values&nbsp;SHADE[];</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;pos1&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;pos2&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">269403</td>
            <td align="right">838</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">32071</td>
            <td align="right">61</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;layers&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_layer_id&nbsp;AND&nbsp;type&nbsp;=&nbsp;&#x27;shade&#x27;)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Shade&nbsp;layer&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&#x27;,&nbsp;p_layer_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Get&nbsp;the&nbsp;required&nbsp;light&nbsp;level&nbsp;and&nbsp;preferred&nbsp;shade&nbsp;level&nbsp;of&nbsp;the&nbsp;plant</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">31236</td>
            <td align="right">55</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;light_requirement,&nbsp;shade&nbsp;INTO&nbsp;plant_light_requirement,&nbsp;plant_shade</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;plants</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_plant_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Create&nbsp;a&nbsp;point&nbsp;from&nbsp;x_pos&nbsp;and&nbsp;y_pos</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">162</td>
            <td align="right">18</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;:=&nbsp;ST_SetSRID(ST_MakePoint(x_pos,&nbsp;y_pos),&nbsp;4326);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Select&nbsp;the&nbsp;shading&nbsp;with&nbsp;the&nbsp;darkest&nbsp;shade&nbsp;that&nbsp;intersects&nbsp;the&nbsp;point</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>25</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">72445</td>
            <td align="right">226</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;shade&nbsp;INTO&nbsp;shading_shade</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>26</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;shadings</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>27</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;layer_id&nbsp;=&nbsp;p_layer_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>28</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(add_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;add_date&nbsp;&lt;=&nbsp;date)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>29</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(remove_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;remove_date&nbsp;&gt;&nbsp;date)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>30</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ST_Intersects(geometry,&nbsp;point)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>31</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;shade&nbsp;DESC</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>32</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;LIMIT&nbsp;1;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>33</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>34</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;there&#x27;s&nbsp;no&nbsp;shading,&nbsp;then&nbsp;there&nbsp;is&nbsp;sun.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>35</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">170</td>
            <td align="right">34</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;FOUND&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>36</code></td>
            <td align="right">9985</td>
            <td class="bar" align="right">89</td>
            <td align="right">34</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shading_shade&nbsp;:=&nbsp;&#x27;no&nbsp;shade&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>37</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>38</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>39</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Check&nbsp;if&nbsp;the&nbsp;plant&nbsp;can&nbsp;survive&nbsp;at&nbsp;the&nbsp;position.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>40</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;the&nbsp;plant&nbsp;can&#x27;t&nbsp;survive&nbsp;set&nbsp;preference=-100&nbsp;and&nbsp;relevance=100.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>41</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">10476</td>
            <td align="right">216</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;plant_light_requirement&nbsp;IS&nbsp;NOT&nbsp;NULL</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>42</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>&nbsp;&nbsp;&nbsp;&nbsp;THEN</code></td>
          </tr>
          <tr>
            <td align="right"><code>43</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">215</td>
            <td align="right">135</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&#x27;full&nbsp;sun&#x27;&nbsp;=&nbsp;ANY(plant_light_requirement)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>44</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>45</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">61</td>
            <td align="right">47</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;:=&nbsp;allowed_shades&nbsp;||&nbsp;&#x27;{&quot;no&nbsp;shade&quot;,&nbsp;&quot;light&nbsp;shade&quot;}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>46</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>47</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">84</td>
            <td align="right">38</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&#x27;partial&nbsp;sun/shade&#x27;&nbsp;=&nbsp;ANY(plant_light_requirement)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>48</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>49</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">34</td>
            <td align="right">13</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;:=&nbsp;allowed_shades&nbsp;||&nbsp;&#x27;{&quot;light&nbsp;shade&quot;,&nbsp;&quot;partial&nbsp;shade&quot;,&nbsp;&quot;permanent&nbsp;shade&quot;}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>50</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>51</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">9</td>
            <td align="right">9</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&#x27;full&nbsp;shade&#x27;&nbsp;=&nbsp;ANY(plant_light_requirement)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>52</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>53</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allowed_shades&nbsp;:=&nbsp;allowed_shades&nbsp;||&nbsp;&#x27;{&quot;permanent&nbsp;shade&quot;,&nbsp;&quot;permanent&nbsp;deep&nbsp;shade&quot;}&#x27;;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>54</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>55</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>56</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">62</td>
            <td align="right">39</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;(shading_shade&nbsp;=&nbsp;ANY(allowed_shades))</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>57</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>58</code></td>
            <td align="right">4</td>
            <td class="bar" align="right">15</td>
            <td align="right">15</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;-100;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>59</code></td>
            <td align="right">4</td>
            <td class="bar" align="right">7</td>
            <td align="right">7</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;100;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>60</code></td>
            <td align="right">4</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>61</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>62</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>63</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>64</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;there&#x27;s&nbsp;no&nbsp;shading,&nbsp;return&nbsp;0.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>65</code></td>
            <td align="right">9996</td>
            <td class="bar" align="right">6</td>
            <td align="right">6</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;plant_shade&nbsp;IS&nbsp;NULL&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>66</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>67</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>68</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>69</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>70</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>71</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Get&nbsp;all&nbsp;possible&nbsp;enum&nbsp;values</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>72</code></td>
            <td align="right">9996</td>
            <td class="bar" align="right">35705</td>
            <td align="right">59</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;enum_range(NULL::SHADE)&nbsp;INTO&nbsp;all_values;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>73</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>74</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Get&nbsp;the&nbsp;position&nbsp;of&nbsp;each&nbsp;enum&nbsp;value&nbsp;in&nbsp;the&nbsp;array</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>75</code></td>
            <td align="right">9996</td>
            <td class="bar" align="right">10523</td>
            <td align="right">28</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;array_position(all_values,&nbsp;plant_shade)&nbsp;INTO&nbsp;pos1;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>76</code></td>
            <td align="right">9996</td>
            <td class="bar" align="right">10214</td>
            <td align="right">26</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;array_position(all_values,&nbsp;shading_shade)&nbsp;INTO&nbsp;pos2;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>77</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>78</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;the&nbsp;&#x27;distance&#x27;&nbsp;to&nbsp;the&nbsp;preferred&nbsp;shade&nbsp;as&nbsp;a&nbsp;values&nbsp;between&nbsp;-1&nbsp;and&nbsp;1</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>79</code></td>
            <td align="right">9996</td>
            <td class="bar" align="right">395</td>
            <td align="right">128</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;(0.5&nbsp;-&nbsp;(abs(pos1&nbsp;-&nbsp;pos2)&nbsp;/&nbsp;(ARRAY_LENGTH(all_values,&nbsp;1)&nbsp;-&nbsp;1)::REAL)^0.5)&nbsp;*&nbsp;2.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>80</code></td>
            <td align="right">9996</td>
            <td class="bar" align="right">168</td>
            <td align="right">13</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;1.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>81</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>82</code></td>
            <td align="right">9996</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>83</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>84</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20437" />
    <h3>
      Function public.calculate_score_from_relations() oid=20437 (<a
        id="toggle_20437"
        href="javascript:toggle_div('toggle_20437', 'div_20437')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 196,206 &micro;s<br />
      total_time = 196,206 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_score_from_relations&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_layer_id integer,<br />&nbsp;p_plant_id integer,<br />&nbsp;date
              date,<br />&nbsp;x_pos integer,<br />&nbsp;y_pos integer,<br />&nbsp;relations
              relations_summary[])</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20437" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">196206</td>
            <td align="right">559</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plant_relation&nbsp;RECORD;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;distance&nbsp;REAL;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;weight&nbsp;REAL;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;start_time&nbsp;timestamp;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;tble&nbsp;TABLE&nbsp;(x&nbsp;INTEGER,&nbsp;y&nbsp;INTEGER,&nbsp;relation&nbsp;RELATION_TYPE);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">194357</td>
            <td align="right">558</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">41853</td>
            <td align="right">195</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;layers&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_layer_id&nbsp;AND&nbsp;type&nbsp;=&nbsp;&#x27;plants&#x27;)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Plant&nbsp;layer&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&#x27;,&nbsp;p_layer_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">134</td>
            <td align="right">25</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">34</td>
            <td align="right">13</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;if&nbsp;relations&nbsp;is&nbsp;null,&nbsp;return&nbsp;0</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">32</td>
            <td align="right">24</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;relations&nbsp;IS&nbsp;NULL&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">136198</td>
            <td align="right">324</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;FOREACH&nbsp;plant_relation&nbsp;IN&nbsp;ARRAY&nbsp;relations&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;calculate&nbsp;euclidean&nbsp;distance</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">323</td>
            <td align="right">68</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distance&nbsp;:=&nbsp;sqrt((plant_relation.x&nbsp;-&nbsp;x_pos)^2&nbsp;+&nbsp;(plant_relation.y&nbsp;-&nbsp;y_pos)^2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>25</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>26</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;calculate&nbsp;weight&nbsp;based&nbsp;on&nbsp;distance</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>27</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;weight&nbsp;decreases&nbsp;between&nbsp;1&nbsp;and&nbsp;0&nbsp;based&nbsp;on&nbsp;distance</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>28</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;distance&nbsp;is&nbsp;squared&nbsp;so&nbsp;it&nbsp;decreases&nbsp;faster&nbsp;the&nbsp;further&nbsp;away</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>29</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;weight&nbsp;is&nbsp;halved&nbsp;at&nbsp;50&nbsp;cm&nbsp;away</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>30</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>31</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w&nbsp;=&nbsp;lambda&nbsp;d:&nbsp;1&nbsp;/&nbsp;(1&nbsp;+&nbsp;(d&nbsp;/&nbsp;50)&nbsp;*&nbsp;(d&nbsp;/&nbsp;50));</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>32</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(10)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>33</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.9615384615384615</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>34</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(20)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>35</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.8620689655172413</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>36</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(30)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>37</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.7352941176470589</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>38</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(40)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>39</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.6097560975609756</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>40</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(50)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>41</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.5</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>42</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(100)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>43</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.2</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>44</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(150)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>45</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.1</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>46</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&gt;&gt;&gt;&nbsp;w(200)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>47</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;0.058823529411764705</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>48</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">295</td>
            <td align="right">129</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weight&nbsp;:=&nbsp;1&nbsp;/&nbsp;(1&nbsp;+&nbsp;(distance&nbsp;/&nbsp;50)^2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>49</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>50</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;score&nbsp;based&nbsp;on&nbsp;relation</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>51</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">364</td>
            <td align="right">94</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;plant_relation.relation&nbsp;=&nbsp;&#x27;companion&#x27;&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>52</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">116</td>
            <td align="right">63</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;score.preference&nbsp;+&nbsp;0.5&nbsp;*&nbsp;weight;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>53</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>54</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;score.preference&nbsp;-&nbsp;0.5&nbsp;*&nbsp;weight;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>55</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>56</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>57</code></td>
            <td align="right">150000</td>
            <td class="bar" align="right">218</td>
            <td align="right">35</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;score.relevance&nbsp;+&nbsp;0.5&nbsp;*&nbsp;weight;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>58</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>59</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>60</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>61</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>62</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20426" />
    <h3>
      Function public.calculate_heatmap() oid=20426 (<a
        id="toggle_20426"
        href="javascript:toggle_div('toggle_20426', 'div_20426')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 65,750 &micro;s<br />
      total_time = 578,463 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_heatmap&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_map_id integer,<br />&nbsp;p_layer_ids integer[],<br />&nbsp;p_plant_id
              integer,<br />&nbsp;date date,<br />&nbsp;granularity integer,<br />&nbsp;x_min
              integer,<br />&nbsp;y_min integer,<br />&nbsp;x_max integer,<br />&nbsp;y_max
              integer)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b
            ><code
              >&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;TABLE(preference&nbsp;real,&nbsp;relevance&nbsp;real,&nbsp;x&nbsp;integer,&nbsp;y&nbsp;integer)</code
            ></b
          >
        </td>
      </tr>
    </table>
    <div id="div_20426" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">578463</td>
            <td align="right">578463</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;map_geometry&nbsp;GEOMETRY(POLYGON,&nbsp;4326);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;GEOMETRY;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;bbox&nbsp;GEOMETRY;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;num_cols&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;num_rows&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;x_pos&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;y_pos&nbsp;INTEGER;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plant_relation&nbsp;RECORD;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;relations&nbsp;relations_summary[];</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">578462</td>
            <td align="right">578462</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Makes&nbsp;sure&nbsp;the&nbsp;layers&nbsp;exists&nbsp;and&nbsp;fits&nbsp;to&nbsp;the&nbsp;map</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">303</td>
            <td align="right">303</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;i&nbsp;IN&nbsp;1..array_length(p_layer_ids,&nbsp;1)&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">2</td>
            <td class="bar" align="right">256</td>
            <td align="right">232</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;layers&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_layer_ids[i]&nbsp;AND&nbsp;map_id&nbsp;=&nbsp;p_map_id)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Layer&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&nbsp;on&nbsp;map&nbsp;with&nbsp;id&nbsp;%&#x27;,&nbsp;p_layer_ids[i],&nbsp;p_map_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Makes&nbsp;sure&nbsp;the&nbsp;plant&nbsp;exists</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">168</td>
            <td align="right">168</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;plants&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_plant_id)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISE&nbsp;EXCEPTION&nbsp;&#x27;Plant&nbsp;with&nbsp;id&nbsp;%&nbsp;not&nbsp;found&#x27;,&nbsp;p_plant_id;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>25</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;INTO&nbsp;STRICT&nbsp;makes&nbsp;sure&nbsp;the&nbsp;map&nbsp;exists.&nbsp;Does&nbsp;have&nbsp;to&nbsp;be&nbsp;explicitly&nbsp;checked&nbsp;as&nbsp;bounding&nbsp;box&nbsp;calculation&nbsp;would&nbsp;error&nbsp;anyways.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>26</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">119</td>
            <td align="right">119</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;geometry&nbsp;FROM&nbsp;maps&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;p_map_id&nbsp;INTO&nbsp;STRICT&nbsp;map_geometry;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>27</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>28</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">1227</td>
            <td align="right">1227</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;relations&nbsp;:=&nbsp;get_plant_relations_array(p_layer_ids[1],&nbsp;p_plant_id,&nbsp;date);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>29</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>30</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;and&nbsp;columns&nbsp;based&nbsp;on&nbsp;the&nbsp;map&#x27;s&nbsp;size&nbsp;and&nbsp;granularity</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>31</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">69</td>
            <td align="right">69</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;num_cols&nbsp;:=&nbsp;FLOOR((x_max&nbsp;-&nbsp;x_min)&nbsp;/&nbsp;granularity);&nbsp;--&nbsp;Adjusted&nbsp;for&nbsp;granularity</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>32</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">13</td>
            <td align="right">13</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;num_rows&nbsp;:=&nbsp;FLOOR((y_max&nbsp;-&nbsp;y_min)&nbsp;/&nbsp;granularity);&nbsp;--&nbsp;Adjusted&nbsp;for&nbsp;granularity</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>33</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>34</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;the&nbsp;score&nbsp;for&nbsp;each&nbsp;point&nbsp;on&nbsp;the&nbsp;heatmap</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>35</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">576559</td>
            <td align="right">576559</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;i&nbsp;IN&nbsp;0..num_cols-1&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>36</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;i&nbsp;and&nbsp;j&nbsp;do&nbsp;not&nbsp;represent&nbsp;coordinates.&nbsp;We&nbsp;need&nbsp;to&nbsp;adjust&nbsp;them&nbsp;to&nbsp;actual&nbsp;coordinates.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>37</code></td>
            <td align="right">100</td>
            <td class="bar" align="right">28</td>
            <td align="right">28</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x_pos&nbsp;:=&nbsp;x_min&nbsp;+&nbsp;(i&nbsp;*&nbsp;granularity)&nbsp;+&nbsp;(granularity&nbsp;/&nbsp;2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>38</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>39</code></td>
            <td align="right">100</td>
            <td class="bar" align="right">576438</td>
            <td align="right">8100</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;j&nbsp;IN&nbsp;0..num_rows-1&nbsp;LOOP</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>40</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">23</td>
            <td align="right">12</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_pos&nbsp;:=&nbsp;y_min&nbsp;+&nbsp;(j&nbsp;*&nbsp;granularity)&nbsp;+&nbsp;(granularity&nbsp;/&nbsp;2);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>41</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>42</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Create&nbsp;a&nbsp;point&nbsp;from&nbsp;x_pos&nbsp;and&nbsp;y_pos</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>43</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">180</td>
            <td align="right">48</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;:=&nbsp;ST_SetSRID(ST_MakePoint(x_pos,&nbsp;y_pos),&nbsp;4326);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>44</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>45</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;the&nbsp;point&nbsp;is&nbsp;on&nbsp;the&nbsp;map&nbsp;calculate&nbsp;a&nbsp;score;&nbsp;otherwise&nbsp;set&nbsp;score&nbsp;to&nbsp;0.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>46</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">558410</td>
            <td align="right">1885</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ST_Intersects(point,&nbsp;map_geometry)&nbsp;THEN</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>47</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">524942</td>
            <td align="right">1694</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;:=&nbsp;calculate_score(p_map_id,&nbsp;p_layer_ids,&nbsp;p_plant_id,&nbsp;date,&nbsp;x_pos,&nbsp;y_pos,&nbsp;relations);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>48</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">20489</td>
            <td align="right">122</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;:=&nbsp;scale_score(score);&nbsp;&nbsp;--&nbsp;scale&nbsp;to&nbsp;be&nbsp;between&nbsp;0&nbsp;and&nbsp;1</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>49</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">6</td>
            <td align="right">6</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preference&nbsp;:=&nbsp;score.preference;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>50</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">17</td>
            <td align="right">13</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relevance&nbsp;:=&nbsp;score.relevance;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>51</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>52</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preference&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>53</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relevance&nbsp;:=&nbsp;0.0;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>54</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>55</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>56</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">5</td>
            <td align="right">5</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;i;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>57</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">5</td>
            <td align="right">5</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;j;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>58</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>59</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">360</td>
            <td align="right">23</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;NEXT;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>60</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>61</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>62</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>63</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20436" />
    <h3>
      Function public.calculate_score() oid=20436 (<a
        id="toggle_20436"
        href="javascript:toggle_div('toggle_20436', 'div_20436')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 42,484 &micro;s<br />
      total_time = 511,079 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.calculate_score&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_map_id integer,<br />&nbsp;p_layer_ids integer[],<br />&nbsp;p_plant_id
              integer,<br />&nbsp;date date,<br />&nbsp;x_pos integer,<br />&nbsp;y_pos
              integer,<br />&nbsp;relations_p relations_summary[])</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20436" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">511079</td>
            <td align="right">1643</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;plants&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;shades&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">508790</td>
            <td align="right">1643</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">211014</td>
            <td align="right">637</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;plants&nbsp;:=&nbsp;calculate_score_from_relations(p_layer_ids[1],&nbsp;p_plant_id,&nbsp;date,&nbsp;x_pos,&nbsp;y_pos,&nbsp;relations_p);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">289486</td>
            <td align="right">979</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;shades&nbsp;:=&nbsp;calculate_score_from_shadings(p_layer_ids[2],&nbsp;p_plant_id,&nbsp;date,&nbsp;x_pos,&nbsp;y_pos);</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">26</td>
            <td align="right">18</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;plants.preference&nbsp;+&nbsp;shades.preference;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">7</td>
            <td align="right">7</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;plants.relevance&nbsp;+&nbsp;shades.relevance;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">6</td>
            <td align="right">6</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20438" />
    <h3>
      Function public.get_plant_relations_array() oid=20438 (<a
        id="toggle_20438"
        href="javascript:toggle_div('toggle_20438', 'div_20438')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 1,177 &micro;s<br />
      total_time = 1,177 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.get_plant_relations_array&nbsp;</code></b>
        </td>
        <td>
          <b
            ><code
              >(p_layer_id integer,<br />&nbsp;p_plant_id integer,<br />&nbsp;date
              date)</code
            ></b
          >
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b
            ><code
              >&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;relations_summary[]</code
            ></b
          >
        </td>
      </tr>
    </table>
    <div id="div_20438" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">1177</td>
            <td align="right">1177</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">1131</td>
            <td align="right">1131</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">1</td>
            <td class="bar" align="right">1131</td>
            <td align="right">1131</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;ARRAY(</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;We&nbsp;only&nbsp;need&nbsp;x,y&nbsp;and&nbsp;type&nbsp;of&nbsp;relation&nbsp;to&nbsp;calculate&nbsp;a&nbsp;score.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;ROW(plantings.x,&nbsp;plantings.y,&nbsp;relations.relation)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;plantings</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;plants&nbsp;ON&nbsp;plantings.plant_id&nbsp;=&nbsp;plants.id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;(</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;We&nbsp;need&nbsp;UNION&nbsp;as&nbsp;the&nbsp;relation&nbsp;is&nbsp;bidirectional.</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>10</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;plant1&nbsp;AS&nbsp;plant,&nbsp;r1.relation</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>11</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;relations&nbsp;r1</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>12</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;plant2&nbsp;=&nbsp;p_plant_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>13</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;r1.relation&nbsp;!=&nbsp;&#x27;neutral&#x27;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>14</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNION</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>15</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;plant2&nbsp;AS&nbsp;plant,&nbsp;r2.relation</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>16</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;relations&nbsp;r2</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>17</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;plant1&nbsp;=&nbsp;p_plant_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>18</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;r2.relation&nbsp;!=&nbsp;&#x27;neutral&#x27;</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>19</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;relations&nbsp;ON&nbsp;plants.id&nbsp;=&nbsp;relations.plant</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>20</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;plantings.layer_id&nbsp;=&nbsp;p_layer_id</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>21</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(plantings.add_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;plantings.add_date&nbsp;&lt;=&nbsp;date)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>22</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(plantings.remove_date&nbsp;IS&nbsp;NULL&nbsp;OR&nbsp;plantings.remove_date&nbsp;&gt;&nbsp;date)</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>23</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>24</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>25</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
    <a name="A20429" />
    <h3>
      Function public.scale_score() oid=20429 (<a
        id="toggle_20429"
        href="javascript:toggle_div('toggle_20429', 'div_20429')"
        >show</a
      >)
    </h3>
    <p>
      self_time = 457 &micro;s<br />
      total_time = 457 &micro;s
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top">
          <b><code>public.scale_score&nbsp;</code></b>
        </td>
        <td>
          <b><code>(input score)</code></b>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <b><code>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;score</code></b>
        </td>
      </tr>
    </table>
    <div id="div_20429" style="display: none">
      <center>
        <table
          class="linestats"
          border="1"
          cellpadding="0"
          cellspacing="0"
          width="80%"
        >
          <tr>
            <th width="10%">Line</th>
            <th width="10%">exec_count</th>
            <th width="10%">total_time</th>
            <th width="10%">longest_time</th>
            <th width="60%">Source Code</th>
          </tr>
          <tr>
            <td align="right"><code>0</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">457</td>
            <td align="right">88</td>
            <td align="left">
              <code><b>--&nbsp;Function&nbsp;Totals</b></code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>1</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
          <tr>
            <td align="right"><code>2</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>DECLARE</code></td>
          </tr>
          <tr>
            <td align="right"><code>3</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;SCORE;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>4</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">241</td>
            <td align="right">87</td>
            <td align="left"><code>BEGIN</code></td>
          </tr>
          <tr>
            <td align="right"><code>5</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">84</td>
            <td align="right">45</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.preference&nbsp;:=&nbsp;1&nbsp;/&nbsp;(1&nbsp;+&nbsp;exp(-input.preference));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;standard&nbsp;sigmoid,&nbsp;so&nbsp;that&nbsp;f(0)=0.5</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>6</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">55</td>
            <td align="right">42</td>
            <td align="left">
              <code
                >&nbsp;&nbsp;&nbsp;&nbsp;score.relevance&nbsp;:=&nbsp;(2&nbsp;/&nbsp;(1&nbsp;+&nbsp;exp(-input.relevance)))&nbsp;-&nbsp;1;&nbsp;&nbsp;&nbsp;--&nbsp;modified&nbsp;sigmoid,&nbsp;so&nbsp;that&nbsp;f(0)=0</code
              >
            </td>
          </tr>
          <tr>
            <td align="right"><code>7</code></td>
            <td align="right">10000</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left">
              <code>&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;score;</code>
            </td>
          </tr>
          <tr>
            <td align="right"><code>8</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code>END;</code></td>
          </tr>
          <tr>
            <td align="right"><code>9</code></td>
            <td align="right">0</td>
            <td class="bar" align="right">0</td>
            <td align="right">0</td>
            <td align="left"><code></code></td>
          </tr>
        </table>
      </center>
    </div>
  </body>
</html>
